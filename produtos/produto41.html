<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio de Relat√≥rio</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        a {
            text-decoration: none;
            color: white;
            background-color: #007bff;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
        }

        a:hover {
            background-color: #0056b3;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            overflow-y: auto;
            max-height: 80vh;
        }

        h2 {
            text-align: center;
            color: #333;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        input[type="text"], input[type="number"], select, input[type="file"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .success-message {
            text-align: center;
            color: green;
            font-weight: bold;
        }

        .error-message {
            text-align: center;
            color: red;
            font-weight: bold;
        }

        .material-quantity {
            display: none;
        }

        .back-button {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        #resetAllCountsButton {
    background-color: #d9534f; /* Vermelho claro */
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

#resetAllCountsButton:hover {
    background-color: #c9302c; /* Vermelho escuro */
}

#confirmResetButton {
    background-color: #5cb85c; /* Verde claro */
    color: white;
    border: none;
    padding: 5px 10px; /* Bot√£o menor */
    font-size: 14px; /* Tamanho de fonte menor */
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
    position: fixed; /* Fixa o bot√£o na tela */
    top: 50%; /* Centraliza verticalmente */
    left: 50%; /* Centraliza horizontalmente */
    transform: translate(-50%, -50%); /* Ajusta para realmente ficar no centro */
    z-index: 1000; /* Certifica que o bot√£o fica acima de outros elementos */
}

#confirmResetButton:hover {
    background-color: #4cae4c; /* Verde escuro */
}

#materiaisAdicionados {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #f9f9f9;
}

#materiaisLista {
    list-style: none;
    padding: 0;
}

#materiaisLista li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}

#materiaisLista li input[type="number"] {
    width: 60px;
    margin-left: 10px;
}

#materiaisLista li button {
    background-color: #d9534f;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
}

#materiaisLista li button:hover {
    background-color: #c9302c;
}

/* Sugest√µes dropdown */
#sugestoesMateriais {
    max-height: 150px; /* Definir um limite de altura para sugest√µes */
    overflow-y: auto;  /* Ativar rolagem nas sugest√µes */
    border: 1px solid #ddd;
    background-color: #fff;
    max-height: 150px;
    overflow-y: auto;
    border-radius: 5px;
    display: none;
    position: absolute;
    z-index: 1000;
    width: 50%;
}

#sugestoesMateriais div {
    padding: 10px;
    cursor: pointer;
}

#sugestoesMateriais div:hover {
    background-color: #f0f0f0;
}



    </style>
</head>
<body>
    <div class="container">
        <h2>Formul√°rio de Relat√≥rio</h2>
        
        <!-- Bot√£o Voltar -->
        <a href="../index.html" class="back-button">Voltar para a p√°gina inicial</a>
        
        <!-- Formul√°rio de Login -->
        <div id="loginForm">
            <label for="login">Login</label>
            <input type="text" id="login" required>
            <button id="loginButton">Entrar</button>
            <p class="error-message" id="loginErrorMessage" style="display:none;">Login inv√°lido.</p>
        </div>
        <!-- Formul√°rio de Relat√≥rio -->
        <form id="reportForm" style="display:none;">
            <label for="qra">QRA integrantes</label>
            <input type="text" id="qra" name="qra" required>

            <label for="rg">RG do detido</label>
            <input type="text" id="rg" name="rg" required>

            <label for="detidoName">Nome do detido</label>
            <input type="text" id="detidoName" name="detidoName" required>

            <label for="localizacao">Localiza√ß√£o</label>
            <select id="localizacao" name="localizacao" required>
                <option value="">Selecione a localiza√ß√£o</option>
                <option value="Los Santos">Los Santos</option>
                <option value="San Fierro">San Fierro</option>
                <option value="Las Venturas">Las Venturas</option>
                <option value="Bone County">Bone County</option>
                <option value="Red County">Red County</option>
                <option value="Flinty County">Flinty County</option>
                <option value="Whetstone County">Whetstone County</option>
            </select>

            <!-- Campo de Refer√™ncias que s√≥ aparecer√° ap√≥s selecionar a localiza√ß√£o -->
            <label for="referencia" id="referenciaLabel" style="display:none;">Refer√™ncia</label>
            <select id="referencia" name="referencia" style="display:none;" required>
                <!-- As op√ß√µes ser√£o carregadas dinamicamente -->
            </select>

            <div>
                <label for="searchMateriais">Buscar Materiais</label>
                <input type="text" id="searchMateriais" placeholder="Digite o nome do material">
                <div id="sugestoesMateriais"></div>
            </div>
            
            <div id="materiaisAdicionados">
                <h4>Materiais Selecionados</h4>
                <ul id="materiaisLista"></ul>
            </div>
            
            

            <label for="imageUpload">Enviar Imagem do invent√°rio do preso</label>
            <input type="file" id="imageUpload" name="imageUpload" accept="image/*" multiple>

            <button type="submit" id="submitButton">Enviar</button>
            <button id="resetAllCountsButton">Zerar Contagem para Todos</button>
        </form>

        <p class="success-message" id="successMessage" style="display:none;">Relat√≥rio enviado com sucesso!</p>
        <p class="error-message" id="errorMessage" style="display:none;">Falha ao enviar o relat√≥rio. Tente novamente.</p>
    </div>
    <div id="loading" style="display: none; text-align: center;">
        <p>Carregando...</p>
    </div>

    <script>
        const form = document.getElementById('reportForm');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const loginForm = document.getElementById('loginForm');
        const loginButton = document.getElementById('loginButton');
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const localizacaoSelect = document.getElementById('localizacao');
        const referenciaSelect = document.getElementById('referencia');
        const referenciaLabel = document.getElementById('referenciaLabel');


// Lista predefinida de materiais
const listaMateriais = [
"Produto Qu√≠mico",
"Adubo",
"Cannabis",
"Folha de coca",
"Kevlar",
"5.56",
"7.62",
"9mm",
"12",
".45",
"Algemas",
"Lixadeira",
"Dinheiro sujo",
"R√°dio",
"Colete",
"Bilhete de corrida",
"Pendrive com informa√ß√µes sigilosas",
"Token de Joalheria",
"Token de Lojinha",
"Coca√≠na",
"Pe√ßa de arma",
"Maconha",
"Laser",
"C4",
"Dinamite",
"Faca",
"Pe√ßas de carro",
"357 Magnum",
"Pneu Blindado",
"USP",
"Revolver",
"Sig Sauer",
"Glock",
"Five Seven",
"Desert Eagle",
"Uzi",
"Double Tec-9",
"G36C",
"IMBEL IA2",
"AK-47",
"Mossberg",
"AA12",
"AR15",
"SG",
"M16",
"Placa Clonada",
"MP5",
"Supressor",
"Molotov"
];

const searchInput = document.getElementById('searchMateriais');
const sugestoesDiv = document.getElementById('sugestoesMateriais');
const materiaisLista = document.getElementById('materiaisLista');

// Mostrar sugest√µes ao digitar
searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();
    sugestoesDiv.innerHTML = ''; // Limpar sugest√µes anteriores

    if (query) {
        const sugestoes = listaMateriais.filter(material =>
            material.toLowerCase().includes(query)
        );

        if (sugestoes.length > 0) {
            sugestoes.forEach(material => {
                const div = document.createElement('div');
                div.textContent = material;
                div.addEventListener('click', () => {
                    adicionarMaterial(material);
                    searchInput.value = ''; // Limpa o campo
                    sugestoesDiv.style.display = 'none'; // Esconde as sugest√µes
                });
                sugestoesDiv.appendChild(div);
            });
            sugestoesDiv.style.display = 'block';
        } else {
            sugestoesDiv.style.display = 'none';
        }
    } else {
        sugestoesDiv.style.display = 'none';
    }
});

// Adicionar material √† lista
function adicionarMaterial(materialNome) {
    // Verifica se o material j√° foi adicionado
    const jaAdicionado = Array.from(materiaisLista.children).some(
        li => li.querySelector('span').textContent === materialNome
    );

    if (!jaAdicionado) {
        const li = document.createElement('li');
        li.innerHTML = `
            <span>${materialNome}</span>
            <input type="number" placeholder="Quantidade" min="1" style="margin-left: 10px;">
            <button type="button" class="removeMaterialButton" style="margin-left: 10px;">Remover</button>
        `;
        materiaisLista.appendChild(li);

        // Faz a rolagem para o final da lista
        materiaisLista.scrollTop = materiaisLista.scrollHeight;
    } else {
        alert('Este material j√° foi adicionado.');
    }
}


// Remover material da lista
materiaisLista.addEventListener('click', (e) => {
    if (e.target.classList.contains('removeMaterialButton')) {
        e.target.parentElement.remove();
    }
});


    
        const users = {
            'POK3': { nome: '<@292006349020069889>', nome2: 'Jason Todd', webhook: "https://discord.com/api/webhooks/1301577538497286214/nqY_cUKVX7TWYIjGzSYPI6dPL1xPVkEpQ2W5pRa_ARVCpc8rrjHkePcOGH-9-04l52CQ" }, // Jason
            'IOP2': { nome: '<@896768740253917195>', nome2: 'Erick Jhonson', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Erick Jhonson
            'NJW2': { nome: '<@1280910661269983313>', nome2: 'Llyson Sousa', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Llyson Sousa
            'CQW1': { nome: '<@895139818877644820>', nome2: 'Medina Amaral', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Medina Amaral
            'KLN1': { nome: '<@499536537520832512>', nome2: 'Lessa Prime', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Lessa Prime
            'TGH2': { nome: '<@978838157665636382>', nome2: 'Japon√™s Mazunio', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Soldado J. Mazzunio - 30211
            'KJGM': { nome: '<@340282044661760000>', nome2: 'Lucas Brand√£o', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, //  L. Brand√£o - 22878
            'MJGN': { nome: '<@1115867304664772648>', nome2: 'Miqueias Petrov', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // M. Petrov - 50262
            'WXR1': { nome: '<@1271717956648304681>', nome2: 'MastWeiler Puro', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" },  // Puro - 54022
            'MFDS': { nome: '<@820437887882493968>', nome2: 'After Corleone', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // After Corleone - 37432
            'KGNS': { nome: '<@681455055144222762>', nome2: 'Murilo Dixon', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Murilo Dixon - 41637
            '45HG': { nome: '<@998364281592619008>', nome2: 'Lyncoln Fortunato', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Lyncoln Fortunato - 17477
            'ZFG2': { nome: '<@620769460114161667>', nome2: 'Araujo Vinceratti', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Araujo Vinceratti - 1233
            'HGRT': { nome: '<@608707769968885801>', nome2: 'Maicon Makarov', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Maicon Makarov - 22000
            'HJGF': { nome: '<@972172838943465532>', nome2: 'Ryan Fox', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Ryan Fox - 19040
            'BXQP': { nome: '<@398256692619378688>', nome2: 'Yunao Fodao', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Yunao Fodao
            'LKMN': { nome: '<@488398332792930325>', nome2: 'Da Rocha Torriceli', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Da Rocha Torriceli
            'RTYH': { nome: '<@1053457219728965683>', nome2: 'Melina Dog', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Melina Dog
            'VFCD': { nome: '<@889182802350866464>', nome2: 'Andriew Mutz', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Andriew Mutz
            'MJHG': { nome: '<@589081060604641313>', nome2: 'Maria Elizabeth', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Maria Elizabeth
            'ZPNQ': { nome: '<@1193730452612202607>', nome2: 'Cassio Viriarto', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Cassio Viriarto
            'QLXE': { nome: '<@677602224817438754>', nome2: 'Hellena FAFA', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Hellena FAFA
            'NDWY': { nome: '<@1173409992829845559>', nome2: 'Bello Jss', webhook: "https://discord.com/api/webhooks/1301943355868975235/gNRigHdEk6etkdayTHl_5Fdc6hP6bwywZY4l3TVzmK7r2YbSEDLh9ILubh549mhQOWUM" }, // Bello Jss
            // Adicione os webhooks para todos os outros usu√°rios
        };
    
        // Mapeamento de localiza√ß√µes para refer√™ncias
        const referencias = {
            'Los Santos': ['Aos arredores da Lojinha pr√≥ximo ao guetto preto', 
            'Aos arredores da garagem da praia',
            'Aos arredores da Garagem pr√≥ximo a prefeitura',
            'Aos arredores da Garagem da prefeitura',
            'Aos arredores da Garagem pr√≥ximo ao HP de LS',
            'Aos arredores do Hotel laranja',
            'Aos arredores do Posto do CJ',
            'Aos arredores da Lojinha do posto do cj',
            'Aos arredores da Cracol√¢ndia',
            'Aos arredores da Ammunation perto da praia',
            'Aos arredores do Lixeiro'
            ],
            
            'San Fierro': ['Aos arredores da Lojinha pr√≥ximo a cracolandia',
            'Aos arredores da Cracolandia',
            'Aos arredores da Garagem perto da cracolandia',
            'Aos arredores do Posto proximo a cracolandia',
            'Aos arredores da Garagem proximo a joalheria',
            'Aos arredores da Garagem proximo ao cinema',
            'Aos arredores da Garagem da antiga transportadora',
            'Aos arredores da Garagem da quadra de t√™nis'
            ],
            
            'Las Venturas': ['Aos arredores da Prefeitura',
            'Aos arredores da Lojinha ao lado da Delegacia',
            'Aos arredores da Cracol√¢ndia',
            'Aos arredores da Garagem do banco',
            'Aos arredores da Lojinha pr√≥ximo ao banco',
            'Aos arredores da Lojinha pr√≥ximo ao ped√°gio',
            'Aos arredores da Garagem da Igreja',
            'Aos arredores do Posto pr√≥ximo a DP'
            ],

            'Red County': ['Aos arredores da Lojinha pr√≥ximo ao emprego de Carniceiro',
            'Aos arredores da Garagem pr√≥ximo ao emprego de Carniceiro',
            'Aos arredores da Gar√°gem pr√≥xima a cidade do emprego de Carniceiro',
            'Aos arredores da Ammunation palomino',
            'Aos arredores da Garagem palomino'
            ],

            'Flinty County': ['Aos arredores da Cracolandia fazenda',
            'Aos arredores da Garagem do greenfarm',
            'Aos arredores da Garagem do HP ilegal'
            ],
            'Whetstone County': ['Aos arredores da Ammunation', 
            'Aos arredores da Garagem'
        ]
        };
    
        let userName = '';
        let userName2 = '';
        let userLogin = '';
        let userWebhook = '';
    
        loginButton.addEventListener('click', function() {
            const login = document.getElementById('login').value;
    
            if (users[login]) {
                userName = users[login].nome;
                userName2 = users[login].nome2;
                userLogin = login; // Armazena o login do usu√°rio que entrou
                userWebhook = users[login].webhook; // Armazenando o webhook do usu√°rio
                loginForm.style.display = 'none';
                form.style.display = 'block';
                // Verificar se j√° existe uma contagem de relat√≥rios para o usu√°rio
                const reportCount = localStorage.getItem(`reportCount_${login}`) || 0;

                loginErrorMessage.style.display = 'none';
            } else {
                loginErrorMessage.style.display = 'block';
            }
        });


const authorizedLogins = ['POK3']; // Substitua pelos logins que t√™m permiss√£o        
const resetAllCountsButton = document.getElementById('resetAllCountsButton');
const confirmResetButton = document.createElement('button'); // Cria um novo bot√£o
confirmResetButton.textContent = 'Confirmar'; // Define o texto do bot√£o
confirmResetButton.style.display = 'none'; // Esconde o bot√£o inicialmente
// ARTE
confirmResetButton.style.backgroundColor = '#5cb85c'; // Cor de fundo verde claro
confirmResetButton.style.color = 'white'; // Cor do texto
confirmResetButton.style.border = 'none'; // Remove a borda
confirmResetButton.style.padding = '5px 10px'; // Bot√£o pequeno e compacto
confirmResetButton.style.fontSize = '14px'; // Tamanho de fonte menor
confirmResetButton.style.borderRadius = '5px'; // Bordas arredondadas
confirmResetButton.style.cursor = 'pointer'; // Cursor de ponteiro ao passar o mouse
confirmResetButton.style.position = 'fixed'; // Posi√ß√£o fixa na tela
confirmResetButton.style.top = '50%'; // Centraliza verticalmente
confirmResetButton.style.left = '50%'; // Centraliza horizontalmente
confirmResetButton.style.width = '120px'; // Define uma largura fixa para o bot√£o
confirmResetButton.style.transform = 'translate(-50%, -50%)'; // Ajusta para o centro exato
confirmResetButton.style
document.body.appendChild(confirmResetButton); // Adiciona o bot√£o ao DOM

// Bot√£o de negar
const denyResetButton = document.createElement('button');
denyResetButton.textContent = 'Negar';
denyResetButton.style.display = 'none'; // Esconde o bot√£o inicialmente
denyResetButton.style.backgroundColor = '#d9534f'; // Cor de fundo vermelho
denyResetButton.style.color = 'white'; // Cor do texto
denyResetButton.style.border = 'none'; // Remove a borda
denyResetButton.style.padding = '5px 10px'; // Bot√£o pequeno e compacto
denyResetButton.style.fontSize = '14px'; // Tamanho de fonte menor
denyResetButton.style.borderRadius = '5px'; // Bordas arredondadas
denyResetButton.style.cursor = 'pointer'; // Cursor de ponteiro ao passar o mouse
denyResetButton.style.position = 'fixed'; // Posi√ß√£o fixa na tela
denyResetButton.style.top = '60%'; // Um pouco abaixo do bot√£o de confirmar
denyResetButton.style.left = '50%'; // Centraliza horizontalmente
denyResetButton.style.transform = 'translate(-50%, -50%)'; // Ajusta para o centro exato
denyResetButton.style.zIndex = '1000'; // Garante que o bot√£o fique acima de outros elementos
denyResetButton.style.width = '120px'; // Define uma largura fixa para o bot√£o
denyResetButton.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)'; // Sombra para um efeito de eleva√ß√£o

document.body.appendChild(denyResetButton); // Adiciona o bot√£o ao DOM

resetAllCountsButton.addEventListener('click', function() {
    if (authorizedLogins.includes(userLogin)) {
        // Mostra o bot√£o de confirma√ß√£o
        confirmResetButton.style.display = 'block';
        denyResetButton.style.display = 'block'; // Mostra o bot√£o de negar
    } else {
        alert('Voc√™ n√£o tem permiss√£o para executar esta a√ß√£o.');
    }
});

// L√≥gica para quando o bot√£o de confirma√ß√£o for clicado
confirmResetButton.addEventListener('click', function() {
    if (authorizedLogins.includes(userLogin)) {
        // Percorra todas as chaves no localStorage
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);

            // Verifique se a chave come√ßa com 'reportCount_'
            if (key.startsWith('reportCount_')) {
                localStorage.setItem(key, 0); // Zere a contagem
            }
        }

        console.log('Contagem de relat√≥rios para todos os usu√°rios foi zerada.');
        alert('A contagem de relat√≥rios para todos os usu√°rios foi zerada com sucesso.');

        // Esconde o bot√£o de confirma√ß√£o novamente
        confirmResetButton.style.display = 'none';
        denyResetButton.style.display = 'none'; // Esconde o bot√£o de negar
    }
});

// L√≥gica do bot√£o de negar
denyResetButton.addEventListener('click', function() {
    alert('A contagem de relat√≥rios n√£o foi zerada.');
    confirmResetButton.style.display = 'none'; // Esconde o bot√£o de confirmar
    denyResetButton.style.display = 'none'; // Esconde o bot√£o de negar
});

loginButton.addEventListener('click', function() {
    const login = document.getElementById('login').value;

    if (users[login]) {
        userLogin = login; // Armazena o login do usu√°rio que entrou
        userName = users[login].nome;
        userName2 = users[login].nome2;
        loginForm.style.display = 'none';
        form.style.display = 'block';
        loginErrorMessage.style.display = 'none';

        // Verifica se o usu√°rio est√° autorizado a ver o bot√£o
        if (authorizedLogins.includes(userLogin)) {
            resetAllCountsButton.style.display = 'block'; // Mostra o bot√£o
        } else {
            resetAllCountsButton.style.display = 'none'; // Esconde o bot√£o
        }
    } else {
        loginErrorMessage.style.display = 'block';
    }
});
    
        // Exibe o menu de refer√™ncias quando uma localiza√ß√£o √© selecionada
        localizacaoSelect.addEventListener('change', function() {
            const localizacao = localizacaoSelect.value;
            if (localizacao && referencias[localizacao]) {
                referenciaSelect.innerHTML = '';
                referencias[localizacao].forEach(ref => {
                    const option = document.createElement('option');
                    option.value = ref;
                    option.textContent = ref;
                    referenciaSelect.appendChild(option);
                });
    
                referenciaLabel.style.display = 'block';
                referenciaSelect.style.display = 'block';
            } else {
                referenciaLabel.style.display = 'none';
                referenciaSelect.style.display = 'none';
            }
        });



        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Incrementar a contagem de relat√≥rios para o usu√°rio atual
            let reportCount = parseInt(localStorage.getItem(`reportCount_${userName2}`)) || 0;
            reportCount += 1;
            localStorage.setItem(`reportCount_${userName2}`, reportCount);


            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            successMessage.style.display = 'none';
    
            const qra = document.getElementById('qra').value;
            const rg = document.getElementById('rg').value;
            const detidoName = document.getElementById('detidoName').value;
            const localizacao = document.getElementById('localizacao').value;
            const referencia = document.getElementById('referencia').value;
            const materiais = [];
            const imageFiles = document.getElementById('imageUpload').files;
            const scriptURL = 'https://script.google.com/macros/s/AKfycbwquwNH9zJmv2DyVD-OB2ANX0Hx016DrF5SI31W8OSvSToSiiDtmSeNXZugkvNWl86zjw/exec';

            // Mostrar a mensagem "Carregando..."
            const loadingMessage = document.getElementById('loading');
           
            // Calcular o tempo de carregamento (1s por item)
            const loadingTime = 5000;
            let remainingTime = loadingTime / 1000; // Converter para segundos
            
            // Mostrar "Carregando..." com a contagem regressiva e esconder o bot√£o "Enviar"
            loadingMessage.textContent = `Carregando... (${remainingTime}s)`;
            loadingMessage.style.display = 'block';
            submitButton.style.display = 'none';
            
            // Atualizar a contagem regressiva a cada segundo
            const countdownInterval = setInterval(() => {
                remainingTime -= 1;
                if (remainingTime > 0) {
                    loadingMessage.textContent = `Carregando... (${remainingTime}s)`;
                }
            }, 1000);
            
            // Ocultar "Carregando..." e mostrar o bot√£o "Enviar" ap√≥s o envio
            setTimeout(() => {
                clearInterval(countdownInterval); // Parar a contagem regressiva
                loadingMessage.style.display = 'none';
                submitButton.style.display = 'inline-block';
                location.reload(); // Recarrega a p√°gina ap√≥s 2 segundos
            }, loadingTime);
    

    
            const cityWebhookMap = {
                "Los Santos": "https://discord.com/api/webhooks/1300151662677065900/OemIF8i1JiS5Exp2qoVBVEr-Mz33-_Ve3TIpVvVB6FgpKPpG__SmVKkVoj9qQCQSkZki",
                "San Fierro": "https://discord.com/api/webhooks/1300151759489990848/mm6lCkxDgVlb7-QbZb8isuhg3Z4qBDza0Utf0udXc5MpFjrBhdUW-tsB1M-WW9ELng1y",
                "Las Venturas": "https://discord.com/api/webhooks/1300151851894833234/j1F_rls6SC7sJtf97SjDSW9xaVfuvtFhc4QURcbmBKHEL2q2NZN2iwzk8YpQlxYXAZDJ",
                "Bone County": "https://discord.com/api/webhooks/1300152034233683968/cHYx0A0jcRaLzhdxa7Sp80f-H2gW9Y7bKe1Akx2EKxS-ctxc265L07UQBXTX4MuUUP5e",
                "Red County": "https://discord.com/api/webhooks/1300152134632869948/jD5wuuEtvbWRmX7ITZM1wbnlPhGBmSfIW2CE_LulmPMiaBJlnlbQt1Gyc34AE4h-_fOV",
                "Flinty County": "https://discord.com/api/webhooks/1300152228434153563/5jeeV0RbEPAqg-MK1sD0aDDEYLAPTakLVk_ZPsEZ4Ye91sz3n80cYV8IKwpcIJCBpTZR",
                "Whetstone County": "https://discord.com/api/webhooks/1300152356947890318/C1RVhxGTXgyTLODlUgK4aYDk8acB0UI5NYRsdtpvyY9BOZXr9RQ9cd4064Y96cfms9GQ",
            };
    
            const selectedCity = localizacao;
            const cityWebhook = cityWebhookMap[selectedCity];
        // Buscar materiais e suas quantidades
            const materiaisSelecionados = Array.from(materiaisLista.children).map(li => {
                const nomeMaterial = li.querySelector('span').textContent;
                const quantidade = li.querySelector('input').value || '1'; // Valor padr√£o para quantidade √© 1
                return `**${nomeMaterial}**: ${quantidade}`;
            });
    
            const formData = new FormData();
            formData.append(
                    'content',
                    `# üìÇ ${userName} Realizou um novo relat√≥rio de apreens√£o\n
üëÆ **QRA:** ${qra}
üìù **RG do detido:** ${rg}
üìù **Nome do detido:** ${detidoName}
üåê **Localiza√ß√£o:** ${localizacao}
üìù **Refer√™ncia:** ${referencia}\n
> üß∞ **Materiais:**\n${materiaisSelecionados.map(material => `> üß∞ ${material}`).join('\n')}`
                );

    for (let i = 0; i < imageFiles.length; i++) {
        formData.append(`file${i}`, imageFiles[i]);
    }

    formData.set('NOME', userName2);
    formData.set('DADOS', '1');
    formData.set('TIPO', 'Apreens√£o');
    formData.set('CIDADE', localizacao);
    formData.set('REFER√äNCIA', referencia);

    try {
        loading.style.display = 'block'; // Mostra a anima√ß√£o de carregamento

        // Enviar para o webhook da cidade
        const cityResponse = await fetch(cityWebhook, {
            method: 'POST',
            body: formData
        });

        // Resetando o FormData para enviar ao webhook do usu√°rio
        // formData.delete('content');
        // formData.append('content', `üìÇ [RELAT√ìRIO] enviados por ${userName}`);

        // Enviar para o webhook do usu√°rio
        const userResponse = await fetch(userWebhook, {
            method: 'POST',
            body: formData
        });

        // Modifica o FormData para incluir uma mensagem fixa
        const arquivo_enviar = await fetch(scriptURL, {
            method: 'POST',
            body: formData
        });

        if (cityResponse.ok && userResponse.ok && arquivo_enviar.ok) {
            loading.style.display = 'none';
            successMessage.style.display = 'block';
            form.reset();
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 2000);
        } else {
            throw new Error('Erro ao enviar o relat√≥rio.');
        }
    } catch (error) {
        loading.style.display = 'none';
        errorMessage.style.display = 'block';
    }
    
        });
    
    </script>
    
</body>
</html>
